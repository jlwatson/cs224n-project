

Raw dump of the notes I got from Satoshi with the headersonly patch (which is
in the git tree as headersonly branch):  

Quote

Here's my client-mode implementation so far. Client-only mode only records
block headers and doesn't use the tx index. It can't generate, but it can
still send and receive transactions. It's not fully finished for use by end-
users, but it doesn't matter because it's a complete no-op if fClient is not
enabled. It's important to get this in as documentation showing the cut-lines
for client-only re-implementers.  
  
If it looks fine to you, go ahead and commit it to SVN. It should be
completely innocuous and no-op.  
  
With fClient=true, I've only tested the header-only initial download.  
  
A little background. CBlockIndex contains all the information of the block
header, so to operate with headers only, I just maintain the CBlockIndex
structure as usual. The nFile/nBlockPos are null, since the full block is not
recorded on disk.  
  
The code to gracefully switch between client-mode on/off without deleting
blk*.dat in between is not implemented yet. It would mostly be a matter of
having non-client LoadBlockIndex ignore block index entries with null block
pos. That would make it re-download those as full blocks. Switching back to
client-mode is no problem, it doesn't mind if the full blocks are there.  
  
If the initial block download becomes too long, we'll want client mode as an
option so new users can get running quickly. With graceful switch-off of
client mode, they can later turn off client mode and have it download the full
blocks if they want to start generating.  

  
My plan was to dive into what Satoshi wrote already, understand it, test it in
fClient=true mode (sending/receiving/relaying transactions on testnet), fix
whatever is broken/unimplemented.  
  
And then write code to switch from fClient=true to fClient=false, downloading
full blocks, etc. And then writing code that does the toggle when generation
is turned on for the first time or when getwork is called (I think those are
the only times you need full blocks).  
  
I haven't looked at or thought about the relaying code. Simply relaying all
transactions (without checking to see if they're valid) if fClient=true should
work nicely.  

