First, the line is established before the proposals begin.  So the
proposer is not determined by lot, everyone knows who will be #1, #2,
etc.  Second, I think the proposer gets to vote.  The wording is a bit
ambiguous, but it just says that "they" vote, and I think "they" pretty
clearly refers to the whole group.

Now here is the solution for two people:

#1 (first in line) proposes that he gets it all.  #1 votes yes, #2 votes
no.  The proposal passes.

Here it is for three people:

#1 (first in line) proposes that he gets it all.  #1 votes yes, #2
probably votes no (since he will get it all if the proposal fails, by
the above) and #3 (end of line) reasons like this: if the proposal
fails, he (#3) will get nothing because #2 will get it all.  Therefore
voting yes or no makes no difference to whether #3 stays alive (his
first priority) or how much money he makes (his second priority).  But
it does make a difference in terms of keeping as many people alive as
possible (his third priority).  So he votes yes because of this third
reason.  Therefore the proposal passes and the first person in line
gets it all in this case.

Of course, #1 could have offered some money to #3 and gotten his vote,
but that would violate the terms of the problem: #1 wants to make as
much money as possible.  And since he can get #3's vote even while
offering nothing to him, that is what he will do.